import{g as H,p as J,u as W,_ as X,$ as Y,c as Q,h as _,a0 as ee,a1 as L,i as l,j,a2 as ae,a3 as le,x as te,Z as se,r as C,y as oe,l as re,E as ne,n as R,z as t,I as N,B as M,C as i,K as p,k as E,a4 as G,Q as ue,L as ie,V as A,D as de,A as s,M as me,N as pe,O as ce,P as ve,F as Ve,G as ge}from"./index-CmyAAO48.js";import{c as fe,e as be,f as ke,a as S,u as xe,b as y,V as ye}from"./index.esm-C03wpfd0.js";import{V as K,a as B}from"./VRow-CJEiUHAW.js";import{b as he}from"./VList-x-rtBMrg.js";import{a as O,m as Ce,V as Ae}from"./VDataTable-BDm0PZDZ.js";import{V as Fe}from"./VToolbar-BBr9NwR9.js";import{V as we}from"./VContainer-OCCqkc1K.js";import{V as Pe}from"./VTextarea-DqxEZMfs.js";import"./ssrBoot-DBo7RvF2.js";import"./VPagination-TKiqiIte.js";const Ue=J({...le(),...ae(Ce(),["inline"])},"VCheckbox"),De=H()({name:"VCheckbox",inheritAttrs:!1,props:Ue(),emits:{"update:modelValue":u=>!0,"update:focused":u=>!0},setup(u,h){let{attrs:V,slots:c}=h;const d=W(u,"modelValue"),{isFocused:$,focus:F,blur:n}=X(u),w=Y(),P=Q(()=>u.id||`checkbox-${w}`);return _(()=>{const[I,T]=ee(V),U=L.filterProps(u),q=O.filterProps(u);return l(L,j({class:["v-checkbox",u.class]},I,U,{modelValue:d.value,"onUpdate:modelValue":m=>d.value=m,id:P.value,focused:$.value,style:u.style}),{...c,default:m=>{let{id:g,messagesId:f,isDisabled:b,isReadonly:v,isValid:k}=m;return l(O,j(q,{id:g.value,"aria-describedby":f.value,disabled:b.value,readonly:v.value},T,{error:k.value===!1,modelValue:d.value,"onUpdate:modelValue":D=>d.value=D,onFocus:F,onBlur:n}),c)}})}),{}}}),je={__name:"stores",setup(u){const{apiAuth:h}=oe(),V=te(),c=se([]),d=C(""),$=Q(()=>[{title:"圖片",align:"center",key:"image",sortable:!1},{title:"麵屋名稱",align:"center",key:"name",sortable:!0},{title:"描述",align:"center",key:"depiction",sortable:!1},{title:"上架中",align:"center",key:"ishidden",sortable:!0},{title:"地址",align:"center",key:"adress",sortable:!1},{title:"營業時間",key:"timetxt",sortable:!1},{title:"新增時間",align:"center",key:"createdAt",sortable:!0},{title:"更新時間",align:"center",key:"updatedAt",sortable:!0},{title:"排序",align:"center",key:"sort",sortable:!0},{title:"編輯",align:"center",key:"edit",sortable:!1}]),F=async()=>{var o,a;try{const{data:r}=await h.get("/store/all");c.push(...r.result)}catch(r){console.error("取得麵屋列表失敗:"+r),V({text:((a=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:a.message)||"取得麵屋列表失敗",snackbarProps:{color:"red",timeout:2e3}})}};F();const n=C({open:!1,id:""}),w=o=>{o?(n.value.id=o._id,m.value.value=o.name,f.value.value=o.timetxt,b.value.value=o.adress,v.value.value=o.sort,k.value.value=!o.ishidden,g.value.value=o.depiction):v.value.value=0,n.value.open=!0},P=()=>{q(),n.value.id="",n.value.open=!1,D.value.deleteFileRecord()},I=fe({name:S().required("請輸入名稱"),depiction:S().required("請輸入描述").max(60,"描述最多 60 個字"),timetxt:S().required("請輸入營業時間"),adress:S().required("請輸入地址"),sort:ke().required("請輸入排序").min(0,"排序至少為0"),ishidden:be().required("請選擇是否上架")}),{handleSubmit:T,isSubmitting:U,resetForm:q}=xe({validationSchema:I}),m=y("name"),g=y("depiction"),f=y("timetxt"),b=y("adress"),v=y("sort"),k=y("ishidden"),D=C(null),x=C([]),z=C([]),Z=T(async o=>{var a;if(x.value.length===0&&n.value.id==""||(a=x.value[0])!=null&&a.error){V({text:"店家圖片不可為空或是格式錯誤",snackbarProps:{color:"red",timeout:2e3}});return}try{const r=new FormData;r.append("name",o.name),r.append("timetxt",o.timetxt),r.append("adress",o.adress),r.append("sort",o.sort),r.append("ishidden",!o.ishidden),r.append("depiction",o.depiction),x.value.length>0&&r.append("image",x.value[0].file),n.value.id?await h.patch("/store/"+n.value.id,r):await h.post("/store",r),c.splice(0,c.length),F(),V({text:n.value.id?"編輯成功":"新增成功",snackbarProps:{color:"green",timeout:2e3}}),P()}catch(r){console.error(r),V({text:"新增/編輯麵屋失敗 ",snackbarProps:{color:"red",timeout:2e3}})}});return(o,a)=>{const r=re("VueFileAgent");return R(),ne(ge,null,[l(we,{class:"h-100","fill-height":"",fluid:""},{default:t(()=>[l(K,{class:"h-100",align:"center"},{default:t(()=>[l(B,{cols:"12"},{default:t(()=>a[11]||(a[11]=[N("h1",{class:"text-center"},"麵屋管理",-1)])),_:1}),l(he),l(B,{col:"12"},{default:t(()=>[l(Ae,{headers:$.value,items:c,search:d.value,"filter-keys":["name","adress"],"items-per-page":10},{top:t(()=>[l(Fe,null,{default:t(()=>[l(M,{"prepend-icon":"mdi-archive-plus",onClick:a[0]||(a[0]=e=>w(null))},{default:t(()=>a[12]||(a[12]=[i("新增麵屋")])),_:1}),l(ie),l(A,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=e=>d.value=e),class:"mt-5","prepend-inner-icon":"mdi-magnify",variant:"outlined",placeholder:"麵屋名稱/地址搜尋"},null,8,["modelValue"])]),_:1})]),"item.image":t(({value:e})=>[l(ue,{src:e,height:"50",width:"80"},null,8,["src"])]),"item.name":t(({value:e})=>[i(p(e),1)]),"item.depiction":t(({value:e})=>[i(p(e),1)]),"item.ishidden":t(({value:e})=>[e?(R(),E(G,{key:1,icon:"mdi-close"})):(R(),E(G,{key:0,icon:"mdi-check"}))]),"item.adress":t(({value:e})=>[i(p(e),1)]),"item.timetxt":t(({value:e})=>[i(p(e),1)]),"item.createdAt":t(({value:e})=>[i(p(new Date(e).toLocaleString()),1)]),"item.updatedAt":t(({value:e})=>[i(p(new Date(e).toLocaleString()),1)]),"item.edit":t(({item:e})=>[l(M,{icon:"mdi-pencil",onClick:Me=>w(e)},null,8,["onClick"])]),_:2},1032,["headers","items","search"])]),_:1})]),_:1})]),_:1}),l(Ve,{modelValue:n.value.open,"onUpdate:modelValue":a[10]||(a[10]=e=>n.value.open=e),persistent:"","max-width":"600px","max-height":"80vh"},{default:t(()=>[l(ye,{disabled:s(U),onSubmit:de(s(Z),["prevent"])},{default:t(()=>[l(me,null,{default:t(()=>[l(pe,null,{default:t(()=>[N("h2",null,p(n.value.id?"編輯麵屋":"新增麵屋"),1)]),_:1}),l(ce,null,{default:t(()=>[l(A,{modelValue:s(m).value.value,"onUpdate:modelValue":a[2]||(a[2]=e=>s(m).value.value=e),label:"名稱","error-messages":s(m).errorMessage.value},null,8,["modelValue","error-messages"]),l(A,{modelValue:s(f).value.value,"onUpdate:modelValue":a[3]||(a[3]=e=>s(f).value.value=e),label:"營業時間","error-messages":s(f).errorMessage.value},null,8,["modelValue","error-messages"]),l(A,{modelValue:s(b).value.value,"onUpdate:modelValue":a[4]||(a[4]=e=>s(b).value.value=e),label:"地址","error-messages":s(b).errorMessage.value},null,8,["modelValue","error-messages"]),l(K,null,{default:t(()=>[l(B,{cols:"3"},{default:t(()=>[l(A,{modelValue:s(v).value.value,"onUpdate:modelValue":a[5]||(a[5]=e=>s(v).value.value=e),type:"number",min:"0",label:"排序","error-messages":s(v).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(B,{cols:"3"},{default:t(()=>[l(De,{modelValue:s(k).value.value,"onUpdate:modelValue":a[6]||(a[6]=e=>s(k).value.value=e),label:"上架","error-messages":s(k).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),l(Pe,{modelValue:s(g).value.value,"onUpdate:modelValue":a[7]||(a[7]=e=>s(g).value.value=e),label:"描述","error-messages":s(g).errorMessage.value},null,8,["modelValue","error-messages"]),l(r,{ref_key:"fileAgent",ref:D,modelValue:x.value,"onUpdate:modelValue":a[8]||(a[8]=e=>x.value=e),"raw-model-value":z.value,"onUpdate:rawModelValue":a[9]||(a[9]=e=>z.value=e),accept:"image/jpeg, image/png",deletable:"","max-size":"1MB","help-text":"請上傳店家圖片","error-text":{type:"檔案格式不符",size:"圖片容量過大"}},null,8,["modelValue","raw-model-value"]),N("pre",null,p(o.errors),1)]),_:1}),l(ve,null,{default:t(()=>[l(M,{onClick:P},{default:t(()=>a[13]||(a[13]=[i("取消")])),_:1}),l(M,{type:"submit",loading:s(U)},{default:t(()=>a[14]||(a[14]=[i("提交")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};export{je as default};
